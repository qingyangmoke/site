<h1 id="åœ°é¼ å’Œå®ƒä»¬çš„åœ°æ´">åœ°é¼ å’Œå®ƒä»¬çš„åœ°æ´</h1>
<blockquote>
  <p>æ‰“åœ°é¼ è¿™ç±»å°æ¸¸æˆå¤§å®¶åº”è¯¥éƒ½å¤šå¤šå°‘å°‘ç©è¿‡ï¼Œå„ç§ç‰ˆæœ¬æ•°ä¸èƒœæ•°ï¼Œä»Šå¤©ï¼Œå°±æ¥ç”¨ Tiny.js ç»™å¤§å®¶è®²ä¸€è®²åœ°é¼ æ˜¯å¦‚ä½•æ‰“æ´çš„ã€‚</p>
</blockquote>
<p>å…ˆé¢„è§ˆä¸€ä¸‹æ•ˆæœï¼š</p>
<video controls="" width="240" name="media"><source src="http://gw.alipayobjects.com/os/rmsportal/ewLodRCQsIIiGaVzQLoX.mp4" type="video/mp4"></video>
<p>è¿™ä¸ªå°æ¸¸æˆå®ç°èµ·æ¥å¯ç®€å•ï¼Œä¹Ÿå¯ä¸ç®€å•ï¼Œæ—¢èƒ½ç®€å•åˆèƒ½ä¼˜é›…çš„å®ç°ï¼Œå°±å¾— Tiny.js ä¸Šåœºäº†ã€‚<br />
ä»”ç»†ç‚¹çš„äººä¼šå‘ç°ï¼Œåœ°æ´æ˜¯ä¸è§„åˆ™çš„ï¼Œè€Œä¸”åœ°é¼ å’Œåœ°æ´ä¹‹é—´ä¹Ÿæ¯«æ— è¿å’Œæ„Ÿï¼Œæ™®é€šæ–¹å¼å¯ä¸å¥½å®ç°ã€‚<br />
ç°åœ¨ï¼Œå°±è®©æˆ‘ä»¬æ­£å¼é¢†ç•¥ä¸€ä¸‹ï¼</p>
<h3 id="1ã€å¼•å…¥-tinyjs">1ã€å¼•å…¥ Tiny.js</h3>
<p>å¼•å…¥çš„æ–¹å¼å¾ˆç®€å•ï¼Œåœ¨ html æ–‡ä»¶ä¸­æ’å…¥ä»¥ä¸‹ scriptï¼š</p>
<pre><code class=" html language- html">&lt;script src="https://a.alipayobjects.com/g/tiny/tiny/1.0.2/tiny.js"&gt;&lt;/script&gt;</code></pre>
<h3 id="2ã€æ–°å»º-application">2ã€æ–°å»º Application</h3>
<p>é¦–å…ˆåˆå§‹åŒ–ä¸€ä¸ª Appï¼Œå†åˆ›å»ºä¸€ä¸ª layerï¼Œè¿è¡Œä¹‹ï¼š</p>
<pre><code class=" js language- js">Tiny.app = new Tiny.Application({
  showFPS: true,
  fixSize: true, // è™½ç„¶æ¸¸æˆæ˜¯é€‚é…ç§»åŠ¨ç«¯çš„ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯å¸Œæœ›æ¼”ç¤ºæ—¶PCä¹Ÿæ˜¯å‹å¥½çš„ï¼Œæ‰€ä»¥å›ºå®šå°ºå¯¸ä¸ºä¼ å…¥çš„å®½é«˜
  height: window.innerHeight,
  width: window.innerWidth,
  dpi: 2, // å’±ä»¬çš„æ¼”ç¤ºæ˜¯é«˜æ¸…çš„ğŸ˜Š
  renderOptions: {
    backgroundColor: 0x7ac9e5
  }
});
// å®šä¹‰ä¸€ä¸ª layerï¼Œæˆ‘ä»¬æŠŠå®ƒä½œä¸ºä¸»åœºæ™¯
var layer = new Tiny.Container();
Tiny.app.run(layer);</code></pre>
<p>çœ‹çœ‹å±å¹•æ˜¯ä¸æ˜¯å˜æˆäº†å¤©è“è‰²ï¼Œè¿™åªæ˜¯å¼€å§‹ï¼Œæ¥ä¸‹æ¥ï¼Œå°†åœ°æ´æ·»åŠ åˆ°åœºæ™¯ä¸­ã€‚</p>
<h3 id="3ã€ä½¿ç”¨-sprite">3ã€ä½¿ç”¨ Sprite</h3>
<p>åˆ›å»º Sprite çš„æ–¹æ³•æœ‰å¤šä¸ªï¼Œæˆ‘ä»¬ç”¨æœ€ç®€å•çš„ï¼š</p>
<pre><code class=" js language- js">var hole = Tiny.Sprite.fromImage('https://a.alipayobjects.com/g/H5Promo/618-payment-promotion/1.0.4/res/images/hole.png');
// è®¾ç½® hole çš„ Y æ–¹å‘ä½ç½®
hole.setPositionY(184 * 2);
// å°† hole åŠ åˆ°åœºæ™¯ä¸­
layer.addChild(hole);</code></pre>
<p>æ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://gw.alipayobjects.com/zos/rmsportal/PpQbyZZfyKqmljZzbcJd.png@240w.src" alt="" /></p>
<h3 id="4ã€ä½¿ç”¨-graphics">4ã€ä½¿ç”¨ Graphics</h3>
<p>ä¸è§„åˆ™çš„åœ°æ´ï¼š</p>
<p><img src="https://gw.alipayobjects.com/zos/rmsportal/PlXWukoCcUgrEQZoXRWL.png" alt="" /></p>
<p>è¯´åˆ°ä¸è§„åˆ™ï¼Œä¸€å®šä¼šæƒ³åˆ°åˆ‡ä¸ªä¸è§„åˆ™çš„ png å›¾ç‰‡ï¼Œä½†æ˜¯è¿™ä¸å¤Ÿçµæ´»ï¼Œæˆ‘ä»¬å¸Œæœ›å®ƒä»¬æ˜¯æ•°å­—é©±åŠ¨ã€‚</p>
<p>ç”¨<code>Tiny.Graphics</code>ç”»ä¸€ä¸ªå»åˆåœ°æ´çš„å›¾å½¢ï¼š</p>
<pre><code class=" js language- js">var g = new Tiny.Graphics();
g.lineStyle(0);
g.beginFill(0xFF0000);
g.moveTo(0, 63);
g.lineTo(64, 130);
g.lineTo(80, 166);
g.lineTo(132, 180);
g.lineTo(164, 158);
g.lineTo(184, 180);
g.lineTo(180, 168);
g.lineTo(230, 158);
g.lineTo(222, 138);
g.lineTo(266, 50);
g.quadraticCurveTo(133, -50, 0, 63);
g.endFill();</code></pre>
<p>æ•ˆæœå¦‚ä¸‹å›¾ï¼š</p>
<p><img src="https://gw.alipayobjects.com/zos/rmsportal/xVrDMTXBYfaDcHDFfuFr.png" alt="" /></p>
<p>åˆèµ·æ¥çœ‹çœ‹ï¼š</p>
<p><img src="https://gw.alipayobjects.com/zos/rmsportal/KndaAzWnXPPHASOhdntF.png@240w.src" alt="" /></p>
<p>9ä¸ªæ´çš„ä½ç½®æ˜¯ç”¨æ•°æ®å¯¹è±¡è®°å½•çš„ï¼š</p>
<pre><code class=" js language- js">var MASK_DATA = [
  {
    x: 22,
    y: 148,
    s: 0.5 * 0.78
  },
  {
    x: 102,
    y: 148,
    s: 0.5 * 0.78
  },
  {
    x: 180,
    y: 148,
    s: 0.5 * 0.78
  },
  {
    x: 0,
    y: 221,
    s: 0.5 * 0.925
  },
  {
    x: 90,
    y: 221,
    s: 0.5 * 0.925
  },
  {
    x: 178,
    y: 221,
    s: 0.5 * 0.925
  },
  {
    x: -13,
    y: 305,
    s: 0.5
  },
  {
    x: 84,
    y: 305,
    s: 0.5
  },
  {
    x: 180,
    y: 305,
    s: 0.5
  }
];</code></pre>
<p>ä½¿ç”¨çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<pre><code class=" js language- js">// å®šä¹‰ä¸€ä¸ªé®ç½©çš„å®¹å™¨ï¼Œç”¨å®ƒæ¥æ‰¿è½½9ä¸ªé®ç½©å…ƒç´ 
var maskContainer = new Tiny.Container();
// å°†é®ç½©å®¹å™¨åŠ åˆ°ä¸»åœºæ™¯ä¸­
layer.addChild(maskContainer);

MASK_DATA.forEach(function (item) {
  // ä½¿ç”¨æ•°æ®å¯¹è±¡åˆ›å»ºé®ç½©å•ä¾‹ï¼Œå¹¶æ·»åŠ åˆ°é®ç½©å®¹å™¨ä¸­
  maskContainer.addChild(generateMask(Tiny.point(item.x, item.y), item.s));
});</code></pre>
<blockquote>
  <p>è¯´æ˜ï¼šè¿™é‡Œçš„<code>generateMask</code>å®é™…ä¸Šæ˜¯å¯¹ä¸Šé¢ç”»ä¸è§„åˆ™å›¾å½¢çš„ä¸€ä¸ªå°è£…ï¼š</p>
<pre><code class=" js language- js">function generateMask(p, scale) {
  var g = new Tiny.Graphics();
  // æ­¤å¤„çœç•¥éƒ¨åˆ†ä»£ç 
  g.setScale(scale * 2);
  g.setPosition(p.x * 2, p.y * 2);
  return g;
}</code></pre>
</blockquote>
<h3 id="5ã€ä½¿ç”¨é®ç½©">5ã€ä½¿ç”¨é®ç½©</h3>
<p>è®¾ç½® Sprite çš„<code>mask</code>å€¼ä¸ºä¸€ä¸ª<code>Graphics</code>å°±å¯ä»¥ä¸ºæ˜¾ç¤ºå¯¹è±¡åšä¸Šé®ç½©äº†ï¼Œé®ç½©çš„é¢ç§¯å°±æ˜¯å›¾å½¢çš„é¢ç§¯</p>
<p>è¿™éƒ¨åˆ†çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class=" js language- js">// å®šä¹‰ä¸€ä¸ªç››æ”¾åœ°é¼ ä»¬çš„å®¹å™¨
var moleContainer = new Tiny.Container();
// å°†åœ°é¼ å®¹å™¨åŠ åˆ°ä¸»åœºæ™¯ä¸­
layer.addChild(moleContainer);

// å®šä¹‰åœ°é¼ çš„ç±»å‹ï¼Œæ³¨æ„ç”¨äºåŠ è½½å¯¹åº”çš„å›¾ç‰‡
var moles = ['ali', 'dc', 'pd', 'ty'];
var indexs = [0, 1, 2, 3, 4, 5, 6, 7, 8];
indexs.forEach(function (i) {
  // éšæœºå–ä¸€ä¸ªç±»å‹
  var type = Tiny.randomFromArray(moles);
  var mole = Tiny.Sprite.fromImage('https://gw.alipayobjects.com/as/g/tiny/resources/1.0.0/images/moles/' + type + '_mole.png');
  // æ­¤å¤„çœç•¥éƒ¨åˆ†å½±å“é˜…è¯»çš„ä»£ç 
  // è®¾ç½® mole çš„é®ç½©ä¸ºå½“å‰ä½ç½®çš„ä¸è§„åˆ™å›¾å½¢
  mole.mask = maskContainer.getChildAt(i);
  // å°†åœ°é¼ æ·»åŠ åˆ°åœ°é¼ å®¹å™¨ä¸­
  moleContainer.addChild(mole);
});</code></pre>
<p>ç„¶åï¼Œä¸€èµ·çœ‹çœ‹å„ç§æƒ…å†µæ—¶çš„æ•ˆæœï¼š</p>
<table>
<thead>
<tr>
<th id="ä¸è®¾ç½®åœ°é¼ çš„_mask_å±æ€§" style="text-align:center;">ä¸è®¾ç½®åœ°é¼ çš„ mask å±æ€§</th>
<th id="é€è§†æ•ˆæœ" style="text-align:center;">é€è§†æ•ˆæœ</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;"><img src="https://gw.alipayobjects.com/zos/rmsportal/KnzlOwzjImOMnNrvjEMV.png" width=240/></td>
<td style="text-align:center;"><img src="https://gw.alipayobjects.com/zos/rmsportal/hXacrMKXdasGZXiJDRFM.png" width=240/></td>
</tr>
</tbody>
</table>
<h3 id="6ã€ä½¿ç”¨-action">6ã€ä½¿ç”¨ Action</h3>
<p>è¿™æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥å¸Œæœ›åœ°é¼ å¯ä»¥é’»å‡ºæ¥ï¼Œé’»è¿›å»ï¼Œé‚£å°±è¦ç”¨åˆ°<code>Tiny.Action</code>äº†ï¼Œæˆ‘ä»¬ç”¨ç¬¬ä¸€ä¸ªåœ°é¼ å®æ–½ä¸€ä¸‹ï¼š</p>
<pre><code class=" js language- js">// ä»åœ°é¼ å®¹å™¨é‡Œå–å‡ºç¬¬ä¸€ä¸ª
var m = moleContainer.getChildAt(0);
// å®šä¹‰ä¸€ä¸ª MoveTo åŠ¨ä½œï¼ŒæŒç»­æ—¶é—´ä¸º 100msï¼Œç§»åŠ¨åˆ°çš„ä½ç½®æ˜¯å½“å‰åœ°é¼ å‘ä¸Š 110 åƒç´ 
var upAction = Tiny.MoveTo(100, Tiny.point(m.x, m.y - 110));
// æœ€åï¼Œä½¿ç”¨æ˜¾ç¤ºå¯¹è±¡ä¸Šçš„æ–¹æ³• runAction è®©åœ°é¼ æ‰§è¡Œ upAction
m.runAction(upAction);</code></pre>
<p>ç„¶åï¼Œç¬¬ä¸€ä¸ªåœ°é¼ å°±é’»å‡ºæ¥äº†ï¼š</p>
<p><img src="https://gw.alipayobjects.com/zos/rmsportal/MaFTXkkptSjjgTALGTlg.png@240w.src" alt="" /></p>
<p>é’»å›å»å…¶å®ä¹Ÿä¸€æ ·ï¼Œåªè¦è®©ç§»åŠ¨åˆ°çš„ä½ç½®å‘ä¸‹ 110 åƒç´ å³å¯ï¼š</p>
<pre><code class=" js language- js">var downAction = Tiny.MoveTo(100, Tiny.point(m.x, m.y + 110));</code></pre>
<h4 id="æ³¨æ„ï¼šæœ¬æ–‡ä¸ºæ¼”ç¤ºæ•ˆæœï¼Œæ‰€æœ‰èµ„æºéƒ½æ˜¯é€šè¿‡é™æ€æ–¹æ³•å¼‚æ­¥åŠ è½½ï¼Œä¸ºä¿è¯æ¸¸æˆä½“éªŒï¼Œå»ºè®®ä½ åœ¨æ­£å¼é¡¹ç›®ä¸­ï¼Œä½¿ç”¨tinyloaderæå‰åŠ è½½æ¸¸æˆèµ„æºã€‚">æ³¨æ„ï¼šæœ¬æ–‡ä¸ºæ¼”ç¤ºæ•ˆæœï¼Œæ‰€æœ‰èµ„æºéƒ½æ˜¯é€šè¿‡é™æ€æ–¹æ³•å¼‚æ­¥åŠ è½½ï¼Œä¸ºä¿è¯æ¸¸æˆä½“éªŒï¼Œå»ºè®®ä½ åœ¨æ­£å¼é¡¹ç›®ä¸­ï¼Œä½¿ç”¨<code>Tiny.Loader</code>æå‰åŠ è½½æ¸¸æˆèµ„æºã€‚</h4>
<hr />
<blockquote>
  <p>æœ¬æ–‡æ¼”ç¤ºä»£ç åœ°å€ï¼š<a href="https://github.com/yiiqii/blog/tree/master/code/tiny/mole.html">https://github.com/yiiqii/blog/tree/master/code/tiny/mole.html</a><br />
  æºç åœ°å€ï¼š<a href="https://github.com/yiiqii/mole">https://github.com/yiiqii/mole</a></p>
</blockquote>
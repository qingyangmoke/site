<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>tinyjs-plugin-audio DEMO</title>
<meta content="yes" name="apple-mobile-web-app-capable"/>
<meta content="yes" name="apple-touch-fullscreen"/>
<meta content="telephone=no,email=no" name="format-detection"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"/>
<style>
html, body, p, div {margin:0;padding:0;}
p {font-size: 32px;text-align: center;padding: 20px 0;}
</style>
</head>
<body>
<p><a href="javascript:;" id="J-playBtn">播放</a></p>
<p><a href="javascript:;" id="J-pauseBtn">暂停</a></p>
<p><a href="javascript:;" id="J-stopBtn">停止</a></p>
<p><a href="javascript:;" id="J-playBtn2">播放2</a></p>
<p><a href="javascript:;" id="J-pauseBtn2">暂停2</a></p>
<p><a href="javascript:;" id="J-stopBtn2">停止2</a></p>
<p id="music1">
  <span style="display: block;font-size: 14px;">getAverageFrequency(获取平均频域数据)-播放1</span>
  <span style="display: block;font-size: 14px;">使用setInterval 100ms取一次</span>
  <span style="display: block;font-size: 12px;"></span>
</p>
<p id="music2">
  <span style="display: block;font-size: 14px;">getAverageFrequency(获取平均频域数据)-播放2</span>
  <span style="display: block;font-size: 14px;">使用setInterval 100ms取一次</span>
  <span style="display: block;font-size: 12px;"></span>
</p>
<script src="https://a.alipayobjects.com/g/tiny/tiny/1.1.0/tiny.js"></script>
<script src="../dist/index.js"></script>

<script type="text/javascript">
  // 加载音频并循环播放
  var analyser;
  Tiny.Loader.add([
    {name: 'music', url: 'https://os.alipayobjects.com/rmsportal/aVTYsHoGDVBnqXKuYDrs.mp3'},
    {name: 'music2', url: 'https://os.alipayobjects.com/rmsportal/aVTYsHoGDVBnqXKuYDrs.mp3'}

  ]);
  Tiny.Loader.load(function(){
    var music = Tiny.audio.manager.getAudio('music');
    var music2 = Tiny.audio.manager.getAudio('music2');

    music.loop = true;
    document.getElementById('J-playBtn').addEventListener('click', function () {
      var $frequency = document.getElementById('music1');
      var analyser = new Tiny.audio.com.AudioAnalyser(music, 256);
      setInterval(function() {
        $frequency.children[2].innerHTML = analyser.getAverageFrequency();
      }, 100);

      music.play();

      console.log(analyser.getAverageFrequency());
    });

    document.getElementById('J-pauseBtn').addEventListener('click', function () {
      music.pause();
    });

    document.getElementById('J-stopBtn').addEventListener('click', function () {
      music.stop();
    });

    document.getElementById('J-playBtn2').addEventListener('click', function () {
      var $frequency = document.getElementById('music2');
      music2.play();
      analyser = new Tiny.audio.com.AudioAnalyser(music2, 256);
      setInterval(function() {
        $frequency.children[2].innerHTML = analyser.getAverageFrequency();
      }, 100);
    });

    document.getElementById('J-pauseBtn2').addEventListener('click', function () {
      music2.pause();
    });

    document.getElementById('J-stopBtn2').addEventListener('click', function () {
      music2.stop();
    });
  });
</script>
</body>
</html>

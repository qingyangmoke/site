/*!
 * tinyjs-plugin-extract
 * Description: 画布扩展，获取画布的：Image 对象、base64 格式的图片、像素值等等
 * Author: yiqi
 * Version: v1.0.6
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.extract=t():(e.Tiny=e.Tiny||{},e.Tiny.extract=t())}(this,function(){return function(e){function t(n){if(r[n])return r[n].exports;var a=r[n]={exports:{},id:n,loaded:!1};return e[n].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var r={};return t.m=e,t.c=r,t.p="/dist",t(0)}([function(e,t,r){e.exports=r(1)},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.canvas=t.webgl=void 0;var a=r(2),i=n(a),o=r(3),u=n(o);t.webgl=i.default,t.canvas=u.default},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=new Tiny.Rectangle,i=4,o=function(){function e(t){r(this,e),this.renderer=t,t.extract=this}return n(e,[{key:"image",value:function e(t){var e=new Image;return e.src=this.base64(t),e}},{key:"base64",value:function(e){return this.canvas(e).toDataURL()}},{key:"canvas",value:function(e){var t=this.renderer,r=void 0,n=void 0,o=void 0,u=!1,s=void 0;e&&(s=e instanceof Tiny.RenderTexture?e:this.renderer.generateTexture(e)),s?(r=s.baseTexture._glRenderTargets[this.renderer.CONTEXT_UID],n=r.resolution,o=s.frame,u=!1):(r=this.renderer.rootRenderTarget,n=r.resolution,u=!0,o=a,o.width=r.size.width,o.height=r.size.height);var d=o.width*n,c=o.height*n,l=new Tiny.CanvasRenderTarget(d,c);if(r){t.bindRenderTarget(r);var f=new Uint8Array(i*d*c),v=t.gl;v.readPixels(o.x*n,o.y*n,d,c,v.RGBA,v.UNSIGNED_BYTE,f);var h=l.context.getImageData(0,0,d,c);h.data.set(f),l.context.putImageData(h,0,0),u&&(l.context.scale(1,-1),l.context.drawImage(l.canvas,0,-c))}return l.canvas}},{key:"pixels",value:function(e){var t=this.renderer,r=void 0,n=void 0,o=void 0,u=void 0;e&&(u=e instanceof Tiny.RenderTexture?e:this.renderer.generateTexture(e)),u?(r=u.baseTexture._glRenderTargets[this.renderer.CONTEXT_UID],n=r.resolution,o=u.frame):(r=this.renderer.rootRenderTarget,n=r.resolution,o=a,o.width=r.size.width,o.height=r.size.height);var s=o.width*n,d=o.height*n,c=new Uint8Array(i*s*d);if(r){t.bindRenderTarget(r);var l=t.gl;l.readPixels(o.x*n,o.y*n,s,d,l.RGBA,l.UNSIGNED_BYTE,c)}return c}},{key:"destroy",value:function(){this.renderer.extract=null,this.renderer=null}}]),e}();Tiny.WebGLRenderer.registerPlugin("extract",o),t.default=o},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=new Tiny.Rectangle,i=function(){function e(t){r(this,e),this.renderer=t,t.extract=this}return n(e,[{key:"image",value:function e(t){var e=new Image;return e.src=this.base64(t),e}},{key:"base64",value:function(e){return this.canvas(e).toDataURL()}},{key:"canvas",value:function(e){var t=this.renderer,r=void 0,n=void 0,i=void 0,o=void 0;e&&(o=e instanceof Tiny.RenderTexture?e:t.generateTexture(e)),o?(r=o.baseTexture._canvasRenderTarget.context,n=o.baseTexture._canvasRenderTarget.resolution,i=o.frame):(r=t.rootContext,i=a,i.width=this.renderer.width,i.height=this.renderer.height);var u=i.width*n,s=i.height*n,d=new Tiny.CanvasRenderTarget(u,s),c=r.getImageData(i.x*n,i.y*n,u,s);return d.context.putImageData(c,0,0),d.canvas}},{key:"pixels",value:function(e){var t=this.renderer,r=void 0,n=void 0,i=void 0,o=void 0;return e&&(o=e instanceof Tiny.RenderTexture?e:t.generateTexture(e)),o?(r=o.baseTexture._canvasRenderTarget.context,n=o.baseTexture._canvasRenderTarget.resolution,i=o.frame):(r=t.rootContext,i=a,i.width=t.width,i.height=t.height),r.getImageData(0,0,i.width*n,i.height*n).data}},{key:"destroy",value:function(){this.renderer.extract=null,this.renderer=null}}]),e}();Tiny.CanvasRenderer.registerPlugin("extract",i),t.default=i}])});
/*!
 * tinyjs-plugin-layer
 * Description: 集成 Scroller 的显示类
 * Author: fangjun.yfj
 * Version: v0.0.1
 */
!function(t,i){"object"==typeof exports&&"object"==typeof module?module.exports=i():"function"==typeof define&&define.amd?define([],i):"object"==typeof exports?exports.Layer=i():(t.Tiny=t.Tiny||{},t.Tiny.Layer=i())}(this,function(){return function(t){function i(o){if(e[o])return e[o].exports;var n=e[o]={exports:{},id:o,loaded:!1};return t[o].call(n.exports,n,n.exports,i),n.loaded=!0,n.exports}var e={};return i.m=t,i.c=e,i.p="/dist",i(0)}([function(t,i,e){t.exports=e(1)},function(t,i,e){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}function n(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function s(t,i){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!i||"object"!=typeof i&&"function"!=typeof i?t:i}function l(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(t,i):t.__proto__=i)}var _=function(){function t(t,i){for(var e=0;e<i.length;e++){var o=i[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(i,e,o){return e&&t(i.prototype,e),o&&t(i,o),i}}(),h=e(2),r=o(h),a=function(t){function i(){n(this,i);var t=s(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return t._list=[],t._style={padding:10,fontSize:14},t.scrollHeight=100,t.scrollWidth=100,t.container=new Tiny.Container,t.container.interactive=!0,t.g=new Tiny.Graphics,t.container.mask=t.g,t.init(),t}return l(i,t),_(i,[{key:"init",value:function(){var t=this;this.scroller=new r.default(function(i,e,o){t.container.position.y=-e},{scrollingY:!0}),this._eventBind(this.scroller),this.addChild(this.container)}},{key:"setHitArea",value:function(t){t instanceof Tiny.Rectangle&&(this.container.hitArea=t)}},{key:"setList",value:function(t){this._list=t,this.refreshList()}},{key:"refreshList",value:function(){var t=this;this.container.removeChildren(),this._list.forEach(function(i,e){var o=new Tiny.Text(i.title,t._style);o.anchor.set(.5),o.position.set(t.scrollWidth/2,o.height*(e+1)),o.interactive=!0,o.touchstart=o.mousedown=function(i){t.timeStamp=i.data.originalEvent.timeStamp,this.scale.set(1.2,1.2)},o.mouseup=o.mouseupoutside=o.touchend=o.touchendoutside=function(t){this.scale.set(1,1)},o.tap=o.click=function(e){e.data.originalEvent.timeStamp-t.timeStamp>150||i.action(e)},t.container.addChildAt(o,e)}),this.scroller.setDimensions(this.scrollWidth,this.scrollHeight,t.container.width,t.container.height)}},{key:"setStyle",value:function(t){this._style=t,this.refreshList()}},{key:"_eventBind",value:function(t){var i=this,e=this.container;e.touchstart=e.mousedown=function(i){var e=i.data.originalEvent;t.doTouchStart(e.touches,e.timeStamp)},e.mousemove=e.touchmove=function(e){var o=e.data.originalEvent;Tiny.rectContainsPoint(new Tiny.Rectangle(0,0,i.scrollWidth,i.scrollHeight),e.data.global)&&t.doTouchMove(o.touches,o.timeStamp,o.scale)},e.mouseup=e.mouseupoutside=e.touchend=e.touchendoutside=function(i){var e=i.data.originalEvent;t.doTouchEnd(e.timeStamp)}}},{key:"_setMask",value:function(){this.removeChild(this.g),this.g.beginFill(16777215),this.g.drawRect(0,0,this.scrollWidth,this.scrollHeight),this.g.endFill(),this.addChild(this.g)}},{key:"setScroll",value:function(t,i){this.scrollWidth=t,this.scrollHeight=i,this._setMask()}}]),i}(Tiny.Container);t.exports=a},function(t,i,e){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}var n=e(3),s=o(n);t.exports=s.default},function(t,i,e){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}var n=e(4),s=o(n),l=function(){},_=function(t,i){this.__callback=t,this.options={scrollingX:!0,scrollingY:!0,animating:!0,animationDuration:250,bouncing:!0,locking:!0,paging:!1,snapping:!1,zooming:!1,minZoom:.5,maxZoom:3,speedMultiplier:1,scrollingComplete:l,penetrationDeceleration:.03,penetrationAcceleration:.08};for(var e in i)this.options[e]=i[e]},h=function(t){return Math.pow(t-1,3)+1},r=function(t){return(t/=.5)<1?.5*Math.pow(t,3):.5*(Math.pow(t-2,3)+2)};_.prototype={__isSingleTouch:!1,__isTracking:!1,__didDecelerationComplete:!1,__isGesturing:!1,__isDragging:!1,__isDecelerating:!1,__isAnimating:!1,__clientLeft:0,__clientTop:0,__clientWidth:0,__clientHeight:0,__contentWidth:0,__contentHeight:0,__snapWidth:100,__snapHeight:100,__zoomLevel:1,__scrollLeft:0,__scrollTop:0,__maxScrollLeft:0,__maxScrollTop:0,__scheduledLeft:0,__scheduledTop:0,__scheduledZoom:0,__lastTouchLeft:null,__lastTouchTop:null,__lastTouchMove:null,__positions:null,__minDecelerationScrollLeft:null,__minDecelerationScrollTop:null,__maxDecelerationScrollLeft:null,__maxDecelerationScrollTop:null,__decelerationVelocityX:null,__decelerationVelocityY:null,setDimensions:function(t,i,e,o){null!==t&&(this.__clientWidth=t),null!==i&&(this.__clientHeight=i),null!==e&&(this.__contentWidth=e),null!==o&&(this.__contentHeight=o),this.__computeScrollMax(),this.scrollTo(this.__scrollLeft,this.__scrollTop,!0)},setPosition:function(t,i){this.__clientLeft=t||0,this.__clientTop=i||0},setSnapSize:function(t,i){this.__snapWidth=t,this.__snapHeight=i},getValues:function(){return{left:this.__scrollLeft,top:this.__scrollTop,right:this.__scrollLeft+this.__clientWidth/this.__zoomLevel,bottom:this.__scrollTop+this.__clientHeight/this.__zoomLevel,zoom:this.__zoomLevel}},getPoint:function(t,i){var e=this.getValues();return{left:t/e.zoom,top:i/e.zoom}},getScrollMax:function(){return{left:this.__maxScrollLeft,top:this.__maxScrollTop}},zoomTo:function(t,i,e,o,n){if(!this.options.zooming)throw new Error("Zooming is not enabled!");n&&(this.__zoomComplete=n),this.__isDecelerating&&(s.default.stop(this.__isDecelerating),this.__isDecelerating=!1);var l=this.__zoomLevel;void 0===e&&(e=this.__clientWidth/2),void 0===o&&(o=this.__clientHeight/2),t=Math.max(Math.min(t,this.options.maxZoom),this.options.minZoom),this.__computeScrollMax(t);var _=t/l,h=_*(this.__scrollLeft+e)-e,r=_*(this.__scrollTop+o)-o;h>this.__maxScrollLeft?h=this.__maxScrollLeft:h<0&&(h=0),r>this.__maxScrollTop?r=this.__maxScrollTop:r<0&&(r=0),this.__publish(h,r,t,i)},zoomBy:function(t,i,e,o,n){this.zoomTo(this.__zoomLevel*t,i,e,o,n)},scrollTo:function(t,i,e,o){if(this.__isDecelerating&&(s.default.stop(this.__isDecelerating),this.__isDecelerating=!1),void 0!==o&&o!==this.__zoomLevel){if(!this.options.zooming)throw new Error("Zooming is not enabled!");t*=o,i*=o,this.__computeScrollMax(o)}else o=this.__zoomLevel;this.options.scrollingX?this.options.paging?t=Math.round(t/this.__clientWidth)*this.__clientWidth:this.options.snapping&&(t=Math.round(t/this.__snapWidth)*this.__snapWidth):t=this.__scrollLeft,this.options.scrollingY?this.options.paging?i=Math.round(i/this.__clientHeight)*this.__clientHeight:this.options.snapping&&(i=Math.round(i/this.__snapHeight)*this.__snapHeight):i=this.__scrollTop,t=Math.max(Math.min(this.__maxScrollLeft,t),0),i=Math.max(Math.min(this.__maxScrollTop,i),0),t===this.__scrollLeft&&i===this.__scrollTop&&(e=!1),this.__publish(t,i,o,e)},scrollBy:function(t,i,e){var o=this.__isAnimating?this.__scheduledLeft:this.__scrollLeft,n=this.__isAnimating?this.__scheduledTop:this.__scrollTop;this.scrollTo(o+(t||0),n+(i||0),e)},doMouseZoom:function(t,i,e,o){var n=t>0?.97:1.03;return this.zoomTo(this.__zoomLevel*n,!1,e-this.__clientLeft,o-this.__clientTop)},doTouchStart:function(t,i){if(void 0===t.length)throw new Error("Invalid touch list: "+t);if(i instanceof Date&&(i=i.valueOf()),"number"!=typeof i)throw new Error("Invalid timestamp value: "+i);this.__interruptedAnimation=!0,this.__isDecelerating&&(s.default.stop(this.__isDecelerating),this.__isDecelerating=!1,this.__interruptedAnimation=!0),this.__isAnimating&&(s.default.stop(this.__isAnimating),this.__isAnimating=!1,this.__interruptedAnimation=!0);var e,o,n=1===t.length;n?(e=t[0].pageX,o=t[0].pageY):(e=Math.abs(t[0].pageX+t[1].pageX)/2,o=Math.abs(t[0].pageY+t[1].pageY)/2),this.__initialTouchLeft=e,this.__initialTouchTop=o,this.__zoomLevelStart=this.__zoomLevel,this.__lastTouchLeft=e,this.__lastTouchTop=o,this.__lastTouchMove=i,this.__lastScale=1,this.__enableScrollX=!n&&this.options.scrollingX,this.__enableScrollY=!n&&this.options.scrollingY,this.__isTracking=!0,this.__didDecelerationComplete=!1,this.__isDragging=!n,this.__isSingleTouch=n,this.__positions=[]},doTouchMove:function(t,i,e){if(void 0===t.length)throw new Error("Invalid touch list: "+t);if(i instanceof Date&&(i=i.valueOf()),"number"!=typeof i)throw new Error("Invalid timestamp value: "+i);if(this.__isTracking){var o,n;2===t.length?(o=Math.abs(t[0].pageX+t[1].pageX)/2,n=Math.abs(t[0].pageY+t[1].pageY)/2):(o=t[0].pageX,n=t[0].pageY);var s=this.__positions;if(this.__isDragging){var l=o-this.__lastTouchLeft,_=n-this.__lastTouchTop,h=this.__scrollLeft,r=this.__scrollTop,a=this.__zoomLevel;if(void 0!==e&&this.options.zooming){var c=a;if(a=a/this.__lastScale*e,a=Math.max(Math.min(a,this.options.maxZoom),this.options.minZoom),c!==a){var u=o-this.__clientLeft,p=n-this.__clientTop;h=(u+h)*a/c-u,r=(p+r)*a/c-p,this.__computeScrollMax(a)}}if(this.__enableScrollX){h-=l*this.options.speedMultiplier;var m=this.__maxScrollLeft;(h>m||h<0)&&(this.options.bouncing?h+=l/2*this.options.speedMultiplier:h=h>m?m:0)}if(this.__enableScrollY){r-=_*this.options.speedMultiplier;var f=this.__maxScrollTop;(r>f||r<0)&&(this.options.bouncing?r+=_/2*this.options.speedMultiplier:r=r>f?f:0)}s.length>60&&s.splice(0,30),s.push(h,r,i),this.__publish(h,r,a)}else{var d=this.options.locking?3:0,g=5,v=Math.abs(o-this.__initialTouchLeft),T=Math.abs(n-this.__initialTouchTop);this.__enableScrollX=this.options.scrollingX&&v>=d,this.__enableScrollY=this.options.scrollingY&&T>=d,s.push(this.__scrollLeft,this.__scrollTop,i),this.__isDragging=(this.__enableScrollX||this.__enableScrollY)&&(v>=g||T>=g),this.__isDragging&&(this.__interruptedAnimation=!1)}this.__lastTouchLeft=o,this.__lastTouchTop=n,this.__lastTouchMove=i,this.__lastScale=e}},doTouchEnd:function(t){if(t instanceof Date&&(t=t.valueOf()),"number"!=typeof t)throw new Error("Invalid timestamp value: "+t);if(this.__isTracking){if(this.__isTracking=!1,this.__isDragging)if(this.__isDragging=!1,this.__isSingleTouch&&this.options.animating&&t-this.__lastTouchMove<=100){for(var i=this.__positions,e=i.length-1,o=e,n=e;n>0&&i[n]>this.__lastTouchMove-100;n-=3)o=n;if(o!==e){var s=i[e]-i[o],l=this.__scrollLeft-i[o-2],_=this.__scrollTop-i[o-1];this.__decelerationVelocityX=l/s*(1e3/60),this.__decelerationVelocityY=_/s*(1e3/60);var h=this.options.paging||this.options.snapping?4:1;(Math.abs(this.__decelerationVelocityX)>h||Math.abs(this.__decelerationVelocityY)>h)&&this.__startDeceleration(t)}else this.options.scrollingComplete()}else t-this.__lastTouchMove>100&&this.options.scrollingComplete();this.__isDecelerating||((this.__interruptedAnimation||this.__isDragging)&&this.options.scrollingComplete(),this.scrollTo(this.__scrollLeft,this.__scrollTop,!0,this.__zoomLevel)),this.__positions.length=0}},__publish:function(t,i,e,o){var n=this.__isAnimating;if(n&&(s.default.stop(n),this.__isAnimating=!1),o&&this.options.animating){this.__scheduledLeft=t,this.__scheduledTop=i,this.__scheduledZoom=e;var l=this.__scrollLeft,_=this.__scrollTop,a=this.__zoomLevel,c=t-l,u=i-_,p=e-a,m=function(t,i,e){e&&(this.__scrollLeft=l+c*t,this.__scrollTop=_+u*t,this.__zoomLevel=a+p*t,this.__callback&&this.__callback(this.__scrollLeft,this.__scrollTop,this.__zoomLevel))}.bind(this),f=function(t){return this.__isAnimating===t}.bind(this),d=function(t,i,e){i===this.__isAnimating&&(this.__isAnimating=!1),(this.__didDecelerationComplete||e)&&this.options.scrollingComplete(),this.options.zooming&&(this.__computeScrollMax(),this.__zoomComplete&&(this.__zoomComplete(),this.__zoomComplete=null))}.bind(this);this.__isAnimating=s.default.start(m,f,d,this.options.animationDuration,n?h:r)}else this.__scheduledLeft=this.__scrollLeft=t,this.__scheduledTop=this.__scrollTop=i,this.__scheduledZoom=this.__zoomLevel=e,this.__callback&&this.__callback(t,i,e),this.options.zooming&&(this.__computeScrollMax(),this.__zoomComplete&&(this.__zoomComplete(),this.__zoomComplete=null))},__computeScrollMax:function(t){void 0===t&&(t=this.__zoomLevel),this.__maxScrollLeft=Math.max(this.__contentWidth*t-this.__clientWidth,0),this.__maxScrollTop=Math.max(this.__contentHeight*t-this.__clientHeight,0)},__startDeceleration:function(t){if(this.options.paging){var i=Math.max(Math.min(this.__scrollLeft,this.__maxScrollLeft),0),e=Math.max(Math.min(this.__scrollTop,this.__maxScrollTop),0),o=this.__clientWidth,n=this.__clientHeight;this.__minDecelerationScrollLeft=Math.floor(i/o)*o,this.__minDecelerationScrollTop=Math.floor(e/n)*n,this.__maxDecelerationScrollLeft=Math.ceil(i/o)*o,this.__maxDecelerationScrollTop=Math.ceil(e/n)*n}else this.__minDecelerationScrollLeft=0,this.__minDecelerationScrollTop=0,this.__maxDecelerationScrollLeft=this.__maxScrollLeft,this.__maxDecelerationScrollTop=this.__maxScrollTop;var l=function(t,i,e){this.__stepThroughDeceleration(e)}.bind(this),_=this.options.snapping?4:.1,h=function(){var t=Math.abs(this.__decelerationVelocityX)>=_||Math.abs(this.__decelerationVelocityY)>=_;return t||(this.__didDecelerationComplete=!0),t}.bind(this),r=function(t,i,e){this.__isDecelerating=!1,this.__didDecelerationComplete&&this.options.scrollingComplete(),this.scrollTo(this.__scrollLeft,this.__scrollTop,this.options.snapping)}.bind(this);this.__isDecelerating=s.default.start(l,h,r)},__stepThroughDeceleration:function(t){var i=this.__scrollLeft+this.__decelerationVelocityX,e=this.__scrollTop+this.__decelerationVelocityY;if(!this.options.bouncing){var o=Math.max(Math.min(this.__maxDecelerationScrollLeft,i),this.__minDecelerationScrollLeft);o!==i&&(i=o,this.__decelerationVelocityX=0);var n=Math.max(Math.min(this.__maxDecelerationScrollTop,e),this.__minDecelerationScrollTop);n!==e&&(e=n,this.__decelerationVelocityY=0)}if(t?this.__publish(i,e,this.__zoomLevel):(this.__scrollLeft=i,this.__scrollTop=e),!this.options.paging){var s=.95;this.__decelerationVelocityX*=s,this.__decelerationVelocityY*=s}if(this.options.bouncing){var l=0,_=0,h=this.options.penetrationDeceleration,r=this.options.penetrationAcceleration;i<this.__minDecelerationScrollLeft?l=this.__minDecelerationScrollLeft-i:i>this.__maxDecelerationScrollLeft&&(l=this.__maxDecelerationScrollLeft-i),e<this.__minDecelerationScrollTop?_=this.__minDecelerationScrollTop-e:e>this.__maxDecelerationScrollTop&&(_=this.__maxDecelerationScrollTop-e),0!==l&&(l*this.__decelerationVelocityX<=0?this.__decelerationVelocityX+=l*h:this.__decelerationVelocityX=l*r),0!==_&&(_*this.__decelerationVelocityY<=0?this.__decelerationVelocityY+=_*h:this.__decelerationVelocityY=_*r)}}},t.exports=_},function(t,i){"use strict";var e="undefined"==typeof window?void 0:window,o=Date.now||function(){return+new Date},n=60,s=1e3,l={},_=1;i.requestAnimationFrame=function(){var t=e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame,i=!!t;if(t&&!/requestAnimationFrame\(\)\s*\{\s*\[native code\]\s*\}/i.test(t.toString())&&(i=!1),i)return function(i,e){t(i,e)};var o=60,n={},s=0,l=1,_=null,h=+new Date;return function(t,i){var e=l++;return n[e]=t,s++,null===_&&(_=setInterval(function(){var t=+new Date,i=n;n={},s=0;for(var e in i)i.hasOwnProperty(e)&&(i[e](t),h=t);t-h>2500&&(clearInterval(_),_=null)},1e3/o)),e}}(),i.stop=function(t){var i=null!==l[t];return i&&(l[t]=null),i},i.isRunning=function(t){return null!==l[t]},i.start=function(t,e,h,r,a,c){var u=o(),p=u,m=0,f=0,d=_++;if(d%20===0){var g={};for(var v in l)g[v]=!0;l=g}var T=function _(g){var v=g!==!0,T=o();if(!l[d]||e&&!e(d))return l[d]=null,void h(n-f/((T-u)/s),d,!1);if(v)for(var S=Math.round((T-p)/(s/n))-1,L=0;L<Math.min(S,4);L++)_(!0),f++;r&&(m=(T-u)/r,m>1&&(m=1));var y=a?a(m):m;t(y,T,v)!==!1&&1!==m||!v?v&&(p=T,i.requestAnimationFrame(_,c)):(l[d]=null,h(n-f/((T-u)/s),d,1===m||void 0===r))};return l[d]=!0,i.requestAnimationFrame(T,c),d}}])});
<!DOCTYPE html>
<html lang="en">

<head>
  <title>Tiny骨骼动画 - 改变动画速度</title>
  <meta charset="utf-8">
  <script src="libs/tiny.debug.js"></script>
  <script src="../dist/index.debug.js"></script>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2,minimum-scale=1,user-scalable=1">
  <style type="text/css">
    body,
    html,
    canvas {
      padding: 0;
      margin: 0;
      -webkit-tap-highlight-color: rgba(0, 0, 0, 0)
    }
  </style>
</head>

<body>

<script>
  var config = {
    showFPS: true, // 显示帧频
    dpi: 1, // 分辨率
    renderOptions: {
      backgroundColor: 0x2a3145 // 画布背景色
    }
  };

  var app = new Tiny.Application(config);

  function setTitle(title, container) {
    var title = new Tiny.Text(title, {
      fontSize: '18px',
      fill: 'white',
    });

    title.position.set(Tiny.WIN_SIZE.width / 2, 30);
    title.anchor.set(0.5, 0);
    container.addChild(title);
  }

  var container = new Tiny.Container();

  setTitle('Tiny骨骼动画演示 - 改变动画速度', container);

  app.run(container);

  //设置别名
  var dragonBones = Tiny.DragonBones;
  var resources = Tiny.Loader.resources;

  var armatureDisplay;


  function createBox(timeScale, x, y, width, height, color) {
    let graphics = new Tiny.Graphics();
    graphics.beginFill(color);
    graphics.drawRect(0, 0, width, height);
    graphics.bounds = new Tiny.Rectangle(0, 0, width, height);
    var rt = Tiny.RenderTexture.create(width, height);
    app.renderer.render(graphics, rt);
    let sprite = new Tiny.Sprite(rt);
    var title = new Tiny.Text(timeScale, {
      fontSize: '18px',
      fill: 'white',
    });
    title.position.set(sprite.width / 2, sprite.height / 2);
    title.anchor.set(0.5, 0.5);
    sprite.addChild(title);
    sprite.position.set(x, y);

    sprite.setEventEnabled(true);

    sprite.mousedown = sprite.touchstart = function (data) {
      data.stopPropagation();
      console.log(title);
      // armatureDisplay.play(name);
      // 改变动画速度 速度慢x1
      armatureDisplay.animation.timeScale = timeScale;
    };

    return sprite;
  }

  function initDragon1() {
    dragonBones.addDragonBonesData(resources["dragonBonesData"].data);
    dragonBones.addTextureAtlasData(resources["textureDataA"].data, resources["textureA"].texture);

    armatureDisplay = dragonBones.buildArmatureDisplay('Dragon');
    armatureDisplay.x = app.renderer.width * 0.5;
    armatureDisplay.y = app.renderer.height * 0.5 - 50;
    armatureDisplay.scale.set(-0.3, 0.3);

    // //DragonBones Pro 默认生成四个动作 fall、jump、stand、walk
    // armatureDisplay.animation.play("walk");
    var animationState = armatureDisplay.play('walk');

    // 改变动画速度 速度慢x1
    // armatureDisplay.animation.timeScale = .5;

    container.addChild(armatureDisplay);

    var top = 60;
    container.addChild(createBox(0.5, 0, top + 0, 100, 30, 0xff0000));
    container.addChild(createBox(1, 0, top + 40, 100, 30, 0xff0000));
    container.addChild(createBox(2, 0, top + 80, 100, 30, 0xff0000));
  }
  Tiny.Loader
    .add("dragonBonesData", "./resource/Dragon/Dragon_ske.json")
    .add("textureDataA", "./resource/Dragon/Dragon_tex.json")
    .add("textureA", "./resource/Dragon/Dragon_tex.png")
    .load(function () {
      initDragon1();
    });
</script>
</body>

</html>
